# TKT-205 Monetization Scaffold v1

## Context

Introduce a payment provider abstraction with a safe disabled default.

## Requirements
- Define `IPaymentProvider` interface and `NoopPaymentProvider`.
- Gate payment flows behind `PAYMENTS_ENABLED` flag.
- Update seller profile to validate amounts and respect flag.

## Data Contracts
- `monetization/intents` documents: `{type, amount, currency, targetUserId?, productId?, createdBy, createdAt, status}`.

## Acceptance Criteria
- No external provider keys required when flag off.
- UI shows "Payments disabled" when flag off.

## Runtime Flags
- `PAYMENTS_ENABLED` (`bool`, default `false`).

## Metrics
- Count of created intents.
- Disabled flow clicks.

## Risks
- Misconfigured flag could expose unfinished payment UI.
- Synthetic IDs may collide; low risk given timestamp.

## Test Plan
- Unit tests for service with flag on/off.
- Widget test for disabled UI.

## Rollback
- Disable flag and remove deployed intents.

Note: There was a merge conflict here and I, the project owner, was not sure how to merge this file properly. This line is where the "=====" signs were. 
Creators need a way to receive financial support from fans. This version records payment intents in Firestore and stubs out a provider interface so real funds never move while the feature is validated.

## Requirements
- Support intents for **tips**, **subscriptions**, and **one-time purchases**.
- Gate all monetization flows behind a runtime flag `PAYMENTS_ENABLED`.
- When disabled, intents are still recorded but marked as `disabled` and the UI informs users.
- No external payment provider keys are used; intents persist in Firestore for future processing.

## Data Contracts
- Collection: `artifacts/{APP_ID}/public/data/monetization/intents/items/{intentId}`
- Fields: `type`, `amount`, `currency`, `targetUserId?`, `productId?`, `createdBy`, `createdAt`, `status`

## Acceptance Criteria
- Calling monetization APIs with `PAYMENTS_ENABLED=true` stores an intent with status `draft`.
- When `PAYMENTS_ENABLED=false`, created intents have status `disabled` and UI blocks payment attempt.
- Amounts must be greater than zero.

## Runtime Flags
- `AppFlags.paymentsEnabled` (`PAYMENTS_ENABLED`)
  - Default: `false`
  - Scope: client and server

## Metrics
- Count of intents created by type
- Error rate when flag disabled
- **Budgets:** p95 client request latency <800 ms; storage and egress growth <20 % MoM

## Risks
- Future provider integration will require PCI compliance and secure key management
- Misconfigured flag could allow unvetted payment flows

## Test Plan
- Unit tests for MonetizationService verifying status under both flag states
- Unit tests for default no-op provider ensuring safe behavior
- Widget tests to surface SnackBar messaging when payments disabled

## Rollback Plan
- Flip `PAYMENTS_ENABLED` to `false`
- Remove UI entry points
- Delete lingering intents if required via script

