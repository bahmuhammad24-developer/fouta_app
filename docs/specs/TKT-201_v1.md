# TKT-201: Stories Model Unification v1

## Context
Two parallel story model definitions (`story.dart` and `story_model.dart`) caused divergence in field coverage and import confusion. Unifying into a single model simplifies maintenance and avoids bugs caused by mismatched types.

## Requirements
- Consolidate story models into `lib/models/story.dart`.
- Preserve existing type aliases and `StoryItem.displayDuration`.
- Remove `story_model.dart` and update all imports to `package:fouta_app/models/story.dart`.
- Add missing fields (`userName`, `userImageUrl`, `id` on slides) from `story_model.dart`.
- No database migrations or schema changes.

## Data Contracts
- `Story`: `{ id: String, authorId: String, userName?: String, userImageUrl?: String, postedAt: DateTime, expiresAt: DateTime, items: [StoryItem], seen: bool, viewedBy: [String] }`
- `StoryItem`: `{ id: String, media: MediaItem, overrideDuration?: Duration, caption?: String, createdAt?: DateTime, expiresAt?: DateTime, viewers: [String] }`

## Acceptance Criteria
- All code imports `package:fouta_app/models/story.dart` only.
- Tests cover story construction, `viewedBy`, `hasUnviewedBy`, and duration override logic.
- No visual or accessibility changes.

## Runtime Flags
- None.

## Metrics
- p95 latency for story fetch < 800 ms.
- Story media egress growth ≤20 % MoM.

## Risks
- Incomplete import updates could break builds.
- Unused fields may increase payload size.
- Test coverage gaps could hide regressions.
- Retrieval of optional fields may be null and cause crashes.
- Build failures if formatting or analysis issues arise.

## Test Plan
- `flutter pub get`
- `dart format --output=none --set-exit-if-changed .`
- `flutter analyze`
- `flutter test --no-pub --coverage`

## Rollback Steps
1. Restore `lib/models/story_model.dart`.
2. Revert imports and code to prior state.
3. Remove added fields from `story.dart`.

## No-Migration Guarantee
This change only consolidates models; Firestore structures remain unchanged.

## Latency/Egress Budgets
Implementation must not exceed p95 latency of 800 ms nor increase story media egress by more than 20 % MoM.
