# TKT-206: Metrics pagination

## Context
Current metrics rollup counts Firestore docs using collectionGroup count, which fails for large datasets >1000 docs due to quota/timeouts.

## Requirements
- Add paginated counting helper `countPaged` using `limit` and `startAfter`.
- Replace existing count calls in `rollupDailyMetrics.ts` with the paginated version.
- Simulate collections with >1000 docs to verify accurate counts.

## Data Contracts
- Input: Firestore collections referenced in rollup job.
- Output: Accurate document counts for each collection.

## Acceptance Criteria
- Rollup job completes without Firestore quota/timeouts.
- Test verifies counts for >1000 mocked documents.

## Runtime Flags
- None.

## Metrics
- Duration of rollup job.
- Firestore reads per execution.

## Risks & Mitigations
- **Risk:** Increased Firestore reads. **Mitigation:** Page size configurable (default 500).
- **Risk:** Helper miscounts docs. **Mitigation:** Unit tests with >1000 docs.

## Test Plan
- Run functions tests to ensure counts match total docs for simulated collections.

## Rollback Plan
- Revert to previous counting logic.
